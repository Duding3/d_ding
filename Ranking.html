<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JiHye Mini-Game Rankings</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background-color: #1a1a1a;
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            color: #4ade80;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }

        .subtitle {
            color: #a0a0a0;
            font-size: 1.1rem;
        }

        .ranking-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 1200px;
        }

        .game-rank-card {
            background: #2d2d2d;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            border: 1px solid #3d3d3d;
        }

        .game-rank-card h2 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 0;
            margin-bottom: 15px;
            color: #4ade80;
            font-size: 1.3rem;
            border-bottom: 1px solid #3d3d3d;
            padding-bottom: 10px;
        }

        .rank-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .rank-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #3d3d3d;
        }

        .rank-item:last-child {
            border-bottom: none;
        }

        .rank-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rank-badge {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .rank-1 {
            background: #ffd700;
            color: #000;
        }

        .rank-2 {
            background: #c0c0c0;
            color: #000;
        }

        .rank-3 {
            background: #cd7f32;
            color: #000;
        }

        .player-name {
            font-weight: bold;
            color: #fff;
        }

        .score {
            font-family: 'Consolas', monospace;
            color: #4ade80;
            font-weight: bold;
        }

        .no-data {
            text-align: center;
            color: #666;
            padding: 20px 0;
            font-style: italic;
        }

        .back-btn {
            margin-top: 40px;
            background: #4ade80;
            color: #000;
            border: none;
            padding: 12px 30px;
            font-size: 1.1rem;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .back-btn:hover {
            background: #22c55e;
            transform: translateY(-2px);
        }

        .reset-all-btn {
            background: transparent;
            border: 1px solid #ef4444;
            color: #ef4444;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 20px;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .reset-all-btn:hover {
            background: rgba(239, 68, 68, 0.1);
        }
    </style>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="firebase-config.js"></script>
</head>

<body>

    <header>
        <h1>ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹ (Hall of Fame)</h1>
        <p class="subtitle">ê° ê²Œì„ì˜ ì „ì„¤ì ì¸ ê¸°ë¡ë“¤</p>
    </header>

    <div class="ranking-container" id="ranking-grid">
        <!-- Javascript will populate ranking cards here -->
    </div>

    <a href="index.html" class="back-btn">
        <i class="fas fa-home"></i> ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
    </a>

    <button class="reset-all-btn" onclick="resetAllRankings()">
        <i class="fas fa-trash-alt"></i> ë­í‚¹ ì´ˆê¸°í™” (ê°œë°œìš©)
    </button>

    <script>
        const games = [
            { id: 'Jump', name: 'ìŠ¬ë¼ì„ ì í”„', icon: 'fa-arrow-up' },
            { id: 'Tetris', name: 'í…ŒíŠ¸ë¦¬ìŠ¤', icon: 'fa-shapes' },
            { id: 'Snake', name: 'ë„¤ì˜¨ ìŠ¤ë„¤ì´í¬', icon: 'fa-wave-square' },
            { id: 'Memory', name: 'ë©”ëª¨ë¦¬ ë§¤ì¹˜', icon: 'fa-cat' }, // Special icon logic maybe
            { id: 'BlockBlast', name: 'ë¸”ë¡ë¸”ë¼ìŠ¤íŠ¸', icon: 'fa-th' },
            { id: 'Catch', name: 'í´ë¼ìš´ ìºì¹˜', icon: 'fa-hands' }, // Moved
            { id: 'Stack', name: 'í¼í™íŠ¸ íƒ€ì›Œ', icon: 'fa-layer-group' },
            { id: 'Dodge', name: 'ì½”ìŠ¤ë¯¹ ë‹·ì§€', icon: 'fa-meteor' },
            { id: 'Dino', name: 'ë‹¬ë ¤ë‹¬ë ¤', icon: 'fa-dragon' }
        ];

        const rankingGrid = document.getElementById('ranking-grid');
        const DATA_KEY_PREFIX = 'ranking_'; // e.g., ranking_Jump

        function loadRankings() {
            if (typeof database === 'undefined') {
                console.error("Firebase Database not initialized.");
                rankingGrid.innerHTML = '<p class="no-data">Firebase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤. firebase-config.js íŒŒì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</p>';
                return;
            }

            database.ref('rankings').once('value').then((snapshot) => {
                const globalRankings = snapshot.val() || {};
                rankingGrid.innerHTML = '';

                games.forEach(game => {
                    const card = document.createElement('div');
                    card.className = 'game-rank-card';

                    const title = document.createElement('h2');
                    title.innerHTML = `<i class="fas ${game.icon}"></i> ${game.name}`;
                    card.appendChild(title);

                    let data = globalRankings[game.id] || [];
                    // Ensure sorted
                    data.sort((a, b) => b.score - a.score);

                    if (data.length === 0) {
                        const noData = document.createElement('div');
                        noData.className = 'no-data';
                        noData.innerText = 'ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.';
                        card.appendChild(noData);
                    } else {
                        const list = document.createElement('ul');
                        list.className = 'rank-list';

                        data.slice(0, 3).forEach((entry, index) => {
                            const li = document.createElement('li');
                            li.className = 'rank-item';

                            li.innerHTML = `
                                <div class="rank-info">
                                    <div class="rank-badge rank-${index + 1}">${index + 1}</div>
                                    <span class="player-name">${escapeHtml(entry.name)}</span>
                                </div>
                                <span class="score">${(entry.score || 0).toLocaleString()}</span>
                            `;
                            list.appendChild(li);
                        });
                        card.appendChild(list);
                    }
                    rankingGrid.appendChild(card);
                });
            }).catch(err => {
                console.error("Firebase fetch error:", err);
                rankingGrid.innerHTML = '<p class="no-data">ë­í‚¹ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. Firebase ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</p>';
            });
        }

        function escapeHtml(text) {
            if (!text) return '';
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        function resetAllRankings() {
            const pwd = prompt('ì´ˆê¸°í™” ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
            if (pwd !== '0512') {
                if (pwd !== null) alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
                return;
            }

            if (confirm('ì •ë§ ëª¨ë“  ì˜¨ë¼ì¸ ë­í‚¹ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ë¡œì»¬ ë°ì´í„°ëŠ” ì‚­ì œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤)')) {
                database.ref('rankings').remove().then(() => {
                    alert('ì˜¨ë¼ì¸ ë­í‚¹ ì´ˆê¸°í™” ì™„ë£Œ!');
                    loadRankings();
                }).catch(err => {
                    alert('ì˜¤ë¥˜ ë°œìƒ: ' + err.message);
                });
            }
        }

        loadRankings();
    </script>
</body>

</html>